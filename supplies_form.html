<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supply Pledge Form</title>
  <link rel="stylesheet" href="styles/styles.css">
  <style>
    .pledge section{ margin-bottom: 3em; }   

    /* Keep tables within the narrow width, centered (page-specific) */
    .pledge .table--narrow{ max-width:600px; margin-inline:auto; }

    /* Set the qty column width only for this page */
    .pledge .table--two-col .col-qty{ width: 10rem; }

    /* Optional: tweak input width used in this form (name/email) */
    .pledge input[type="text"]{ max-width: 240px; }

  </style>
</head>

<body class="pledge">
  <div class="container container--narrow">
    <h1>What Are You Bringing?</h1>
    <p>This form serves as a way to inform JMAC of the items you intend to bring to the hygiene kit assembly event at {location} at {time}. Items may also be dropped off at {} before the event. We will send a remind email {} days prior with a reminder of the event and the items you indicated you would bring.   </p>
  </div>
  <form id="pledge-form" class="container container--narrow">
    <section>
      <h3>Contact Information</h3>
        <label for="fname">Name:</label>
        <input type="text" name="name">
        <label for="email">Email:</label>
        <input type="text" name="email" required>
    </section>

    <section>
      <h3>What are you bringing?</h3>
      <table class="table table--narrow table--two-col">
        <colgroup>
          <col class="col-item">
          <col class="col-qty">
        </colgroup>
        <tr><th>Toiletries</th><th>How Many?</th></tr>
        <tr><td>Toothbrushes</td><td><input type="number" name="qty_toothbrushes" min="0"></td></tr>
        <tr><td>Toothpaste</td><td><input type="number" name="qty_toothpaste" min="0"></td></tr>
        <tr><td>Deodorant</td><td><input type="number" name="qty_deodorant" min="0"></td></tr>        <tr><td>Shampoo</td><td><input type="number" name="qty_shampoo" min="0"></td></tr>       <tr><td>Soap</td><td><input type="number" name="qty_soap" min="0"></td></tr>
        <tr><td>Soap Box</td><td><input type="number" name="qty_soap_box" min="0"></td></tr>
        <tr><td>Lip Balm</td><td><input type="number" name="qty_lip_balm" min="0"></td></tr>
        <tr><td>Sunscreen</td><td><input type="number" name="qty_sunscreen" min="0"></td></tr>       <tr><td>Lotion</td><td><input type="number" name="qty_lotion" min="0"></td></tr>
        <tr><td>Hand Sanitizer</td><td><input type="number" name="qty_hand_sanitizer" min="0"></td></tr>
        <tr><td>Nail Clippers</td><td><input type="number" name="qty_nail_clippers" min="0"></td></tr>
        <tr><td>Nail File</td><td><input type="number" name="qty_nail_files" min="0"></td></tr>
        <tr><td>Shaving Kit</td><td><input type="number" name="qty_shaving_kit" min="0"></td></tr>
        <tr><td>Combs</td><td><input type="number" name="qty_combs" min="0"></td></tr>
        <tr><td>Q-tip Container</td><td><input type="number" name="qty_qtip_container" min="0"></td></tr>
        <tr><td>Q-tips</td><td><input type="number" name="qty_qtips" min="0"></td></tr>
        <tr><td>Wipes</td><td><input type="number" name="qty_wipes" min="0"></td></tr>
      </table>
      <table class="table table--narrow table--two-col">
          <colgroup>
            <col class="col-item">
            <col class="col-qty">
          </colgroup>
          <tr><th>Medical Supplies </th><th>How Many?</th></tr>
          <tr><td>Tylenol</td><td><input type="number" name="qty_tylenol" min="0"></td></tr>
          <tr><td>Advil</td><td><input type="number" name="qty_advil" min="0"></td></tr>
          <tr><td>Alcohol Wipes</td><td><input type="number" name="qty_alcohol_wipes" min="0"></td></tr>
          <tr><td>Bandaids</td><td><input type="number" name="qty_bandaids" min="0"></td></tr>
          <tr><td>Eye Drops</td><td><input type="number" name="qty_eye_drops" min="0"></td></tr>
          <tr><td>Alka-Seltzer Cold/Flu</td><td><input type="number" name="qty_alkaseltzer_coldflu" min="0"></td></tr>
          <tr><td>Face Masks</td><td><input type="number" name="qty_face_masks" min="0"></td></tr>
          <tr><td>Condoms</td><td><input type="number" name="qty_condoms" min="0"></td></tr>
          <tr><td>Electrolyte Packs</td><td><input type="number" name="qty_electrolyte_packs" min="0"></td></tr>
          <tr><td>Fentanyl Test Strips</td><td><input type="number" name="qty_fentanyl_test_strips" min="0"></td></tr>
          <tr><td>Narcan</td><td><input type="number" name="qty_narcan" min="0"></td></tr>
      </table>
      <table class="table table--narrow table--two-col">
          <colgroup>
            <col class="col-item">
            <col class="col-qty">
          </colgroup>
          <tr><th>Menstrual Supplies</th><th>How Many?</th></tr>
          <tr><td>Menstrual Pads</td><td><input type="number" name="qty_pads" min="0"></td></tr>
          <tr><td>Tampons</td><td><input type="number" name="qty_tampons" min="0"></td></tr>
          <tr><td>Menstrual Liners</td><td><input type="number" name="qty_liners" min="0"></td></tr>
          <tr><td>Pregnancy Test</td><td><input type="number" name="qty_pregnancy_test" min="0"></td></tr>
      </table>
      <table class="table table--narrow table--two-col">
          <colgroup>
            <col class="col-item">
            <col class="col-qty">
          </colgroup>
          <tr><th>Miscellaneous Supplies</th><th>How Many?</th></tr>
          <tr><td>Gallon Zip Lock Bag</td><td><input type="number" name="qty_gallon_zip_lock_bag" min="0"></td></tr>
          <tr><td>Small Zipper Bags</td><td><input type="number" name="qty_small_zipper_bag" min="0"></td></tr>
          <tr><td>Playing Cards</td><td><input type="number" name="qty_playing_cards" min="0"></td></tr>
          <tr><td>Sunglasses</td><td><input type="number" name="qty_sunglasses" min="0"></td></tr>
          <tr><td>Lighters</td><td><input type="number" name="qty_lighters" min="0"></td></tr>
          <tr><td>Bus Passes</td><td><input type="number" name="qty_bus_passes" min="0"></td></tr>
          <tr><td>Poncho</td><td><input type="number" name="qty_ponchos" min="0"></td></tr>
          <tr><td>Notebooks</td><td><input type="number" name="qty_notebook" min="0"></td></tr>
          <tr><td>Pens/Pencils</td><td><input type="number" name="qty_pen_pencil" min="0"></td></tr>
          <tr><td>Hair Ties</td><td><input type="number" name="qty_hair_tie" min="0"></td></tr>
          <tr><td>Socks</td><td><input type="number" name="qty_socks" min="0"></td></tr>
      </table>
      <table class="table table--narrow table--two-col">
          <colgroup>
            <col class="col-item">
            <col class="col-qty">
          </colgroup>
          <tr><th>Food Items</th><th>How Many?</th></tr>
          <tr><td>Snack</td><td><input type="number" name="qty_snack" min="0"></td></tr>
          <tr><td>Water Bottles</td><td><input type="number" name="qty_water" min="0"></td></tr>
      </table>
      <table class="table table--narrow table--two-col">
          <colgroup>
            <col class="col-item">
            <col class="col-qty">
          </colgroup>
          <tr><th>Other Items</th><th>How Many?</th></tr>
          <tr><td><input type="text" name="other" placeholder="Item name or description"></td><td><input type="number" name="qty_other" min="0"></td></tr>
      </table>
    </section>

    <div class="container container--narrow">
      <button type="submit" class="button">Submit</button>
    </div>
  </form> 

  <div class="container container--narrow">
    <h3>Submitted Data:</h3>
    <div id="output" style="white-space:pre-wrap; background:#f9f9f9; padding:1em; border:1px solid #ccc;"></div>
  </div>

<script>
  // We're sending the data from this form to the below web app url location
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzx4U67GpDFN5NOkd3NtE0hTajBbNvlHZOMfmkK5HcBYaO2sF3YuXcFybiT4ARWVHxxLg/exec';
  
  const form   = document.getElementById('pledge-form');
  const output = document.getElementById('output');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Turn the form into an object: { name: value, ... }
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    // Normalize qty_ fields: ensure numbers, empty -> 0
    Object.keys(data).forEach(k => {
      if (k.startsWith('qty_')) {
        const n = Number(data[k]);
        data[k] = Number.isFinite(n) ? n : 0;
      }
    });

    // Optional client-side validation (add more as needed)
    if (!data.email) {
      output.textContent = 'Please enter your email.';
      return;
    }

    // Add a client-side timestamp as ISO string (server also stamps Date)
    data.client_timestamp = new Date().toISOString();

    // Submit using a "simple request" to avoid CORS preflight.
    try {
      // Disable button while submitting
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;

      await fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(data)
      });

      output.textContent = 'Thanks! Your pledge was recorded.';
      form.reset();
    } catch (err) {
      console.error(err);
      output.textContent = 'Sorry, something went wrong submitting your pledge.';
    } finally {
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = false;
    }
  });
</script>
</body>

</html>
